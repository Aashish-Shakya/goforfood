<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food 4 You</title>
    <link rel="stylesheet" href="styles/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
        integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="/styles/c">

    <script src="js/cart.js" async></script>
    <style type="text/css">
        .display-1 {
            text-indent: 50px;
            text-align: center;
            letter-spacing: 3px;
            font-style: italic;
            font-weight: bold;
            font-size: 40px;
            margin: inherit;
        }
    </style>


</head>

<body onload="submitPayuForm();">
    <script>


        var hash = '<%=hash%>';
        function submitPayuForm() {

            if (hash == '')
                return;

            var payuForm = document.forms.payuForm;
            payuForm.submit();
        }

        function paycod() {
            window.location = 'cod.jsp';
        }
    </script>


    <div class="cartbody">
        <div class="container">
            <div class="Cart-Container cart">
                <h3 class="Heading">Shopping Cart</h3>

                "<div>
                    <h5 class=\"Action\" onclick=\"removeAll()\" style=\"text-align: right;\">Remove all</h5>"
                    + "
                </div>"

                + "<table class=\"table\">" + "<thead>" + "<tr>" + "<th scope=\"col\">Product</th>"
                            + "<th scope=\"col\">Name</th>" + "<th scope=\"col\">Quantity</th>"
                            + "<th scope=\"col\">Price</th>" + "<th scope=\"col\">Cost</th>"
                            + "<th scope=\"col\">Remove</th>" + "</tr>" + "
                    </thead>" + "<tbody>");

                        for (Map.Entry<Dish, Integer> item : map.entrySet()) {
                            totalamount += ((item.getKey().getPrice() -
                            item.getKey().getDiscount()) * item.getValue());
                            if (item.getKey() != null) {
                            out.print("<tr>
                                <td class=\"image-box\"><img src=\"" + item.getKey().getImage_url() + "\"
                                        style=\"height: 120px;\" /></td>" + "<td class=\"about\">"
                                    + "<h1 class=\"title\">" +
                                        item.getKey().getName() + "</h1>" + "
                                </td>"
                                + "<td class=\"counter\">" + "<div onclick=\"updateQty('" + item.getKey().getName()
                                        + "', " + (item.getValue() - 1) + ")\" class=\"btn\">-</div>"
                                    + "<div class=\"count\">" + item.getValue()
                                        + "</div>"
                                    + "<div onclick=\"updateQty('" + item.getKey().getName() + "', " + (item.getValue()
                                        + 1) + ")\" class=\"btn\">+</div>" + "</td>"
                                + "<td class=\"unit_price\">"
                                    + (item.getKey().getPrice() -
                                    item.getKey().getDiscount()) + "</td>"
                                + "<td class=\"prices\">" + "<div class=\"amount\">"
                                        + ((item.getKey().getPrice() -
                                        item.getKey().getDiscount()) *
                                        item.getValue())
                                        + "</div>" + "</td>
                                <td>
                                    <div onclick=\"remove('" + item.getKey().getName() + "', " + (item.getValue() + 1)
                                        + ")\" class=\"remove\"><u>Remove</u></div>
                                </td>
                            </tr>");
                            }
                            }
                            out.print("</table>");
                int totalItems = cartBo.total((String)
                session.getAttribute("username"));

                out.print(
                "<div class=\"checkout\">
                    <div class=\"total\">
                        <div class=\"grandtotal\">
                            <div class=\"Subtotal\">Sub-Total</div>
                            <div class=\"items\">");
                                if (totalItems > 1) {
                                out.print(totalItems + " items");
                                } else {
                                out.print(totalItems + " item");
                                }

                                out.print("</div>
                        </div>
                        <div class=\"total-amount\">Rs. " + totalamount + "
                        </div>
                    </div>
                </div>");
                } else {
                out.print("<h1 class=\"display-1\">
                    <p> There are no item in the cart.</p>
                </h1>");
                }
                } else {
                out.print("<h1 class=\"display-1\" style=\"color: red\">
                    <p> Please Log in first!</p>
                </h1>");
                }
                session.setAttribute("cart", map);
                session.setAttribute("tamount", totalamount.toString());
                %>
            </div>
        </div>


        <div class="container">
            <div class="Cart-Container billing">
                <div class="row">
                    <div class="col-75">
                        <div>

                            <div class="row">
                                <div class="col-50">
                                    <h3 class="DA">Delivery Address</h3>
                                    <br> <br> <br> <label for="fname"><i class="fa fa-user"></i> Full
                                        Name</label> <input type="text" id="fname" name="firstname"
                                        value="<%=(empty((String) session.getAttribute(" fname"))) ? "" :
                                        session.getAttribute("fname").toString()%>">
                                    <label for="email"><i class="fa fa-envelope"></i>
                                        Email</label>
                                    <input type="text" id="email" name="email"
                                        value="<%=(empty((String) session.getAttribute(" email"))) ? "" :
                                        session.getAttribute("email").toString()%>">
                                    <label for="mob"><i class="fa fa-phone"></i>
                                        Address</label> <input type="text" id="mob" name="mobile"
                                        value="<%=(empty((String) session.getAttribute(" mobileno"))) ? "" :
                                        session.getAttribute("mobileno").toString()%>">
                                    <label for="adr"><i class="fa fa-address-card-o"></i>
                                        Address</label> <input type="text" id="adr" name="address"
                                        value="<%=(empty((String) session.getAttribute(" address"))) ? "" :
                                        session.getAttribute("address").toString()%>">
                                    <label for="city"><i class="fa fa-institution"></i>
                                        City</label> <input type="text" id="city" name="city" value="">
                                    <div class="row">
                                        <div class="col-50">
                                            <label for="state">State</label> <input type="text" id="state" name="state">
                                        </div>
                                        <div class="col-50">
                                            <label for="zip">Zip</label> <input type="text" id="zip" name="zip">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% session.setAttribute("amount", totalamount.toString()); %>
                                <form action="<%=action1%>" method="post" name="payuForm">
                                    <input type="hidden" name="key" value="<%=merchant_key%>" /> <input type="hidden"
                                        name="hash" value="<%=hash%>" /> <input type="hidden" name="txnid"
                                        value="<%=txnid%>" /> <input type="hidden" name="udf2" value="<%=txnid%>" />
                                    <input type="hidden" name="service_provider" value="payu_paisa" /> <input
                                        type="hidden" name="amount" value="<%=totalamount%>" />
                                    <input type="hidden" name="firstname" id="firstname" value="<%=(empty(params.get("
                                        firstname"))) ? "" : params.get("firstname")%>" />

                                    <input type="hidden" name="email" id="email" value="<%=(empty(params.get(" email")))
                                        ? "" : params.get("email")%>" />

                                    <input type="hidden" name="phone" value="<%=(empty(params.get(" phone"))) ? "" :
                                        params.get("phone")%>" />

                                    <input type="hidden" name="productinfo" value="<%=(empty(params.get("
                                        productinfo"))) ? "" : params.get("productinfo")%>"
                                    size="64" /> <input type="hidden" name="surl" value="<%=(empty(params.get(" surl")))
                                        ? "" : params.get("surl")%>"
                                    size="64" /> <input type="hidden" name="furl" value="<%=(empty(params.get(" furl")))
                                        ? "" : params.get("furl")%>"
                                    size="64" />

                                    <% if (empty(hash)) { %>
                                        <div class="payu">
                                            <input type="submit" value="PayUmoney" class="checkoutbtn" />
                                            <input type="button" onclick="paycod()" value="COD" class="checkoutbtn" />
                                        </div>
                                        <% } %>


                                </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        if (sessionStorage.getItem("city") != null) {
            document.getElementById("city").value = sessionStorage
                .getItem("city")
        }

        if (sessionStorage.getItem("state") != null) {
            document.getElementById("state").value = sessionStorage
                .getItem("state")
        }

        if (sessionStorage.getItem("pincode") != null) {
            document.getElementById("zip").value = sessionStorage
                .getItem("pincode")
        }
    </script>

</body>

</html>